a = new 1=>2<String[(a+b)*]>; 2=>1<String[a*]>;Gend;
def As() =
  s=new a@(2 of 2);
  s[1]>>str;
  def A(abs : String[(a+b)*], s: 2=>1:2<String[a*]>@(2 of 2) ) =
    match abs
    { r"b*" => s[1]<<nil;end,
      r"(b*a)(a+b)*" as ((bs,a),abs2) => s[1]<<cons; A(abs2,s)
    }
  in A(str,s)
in As()
| s=new a@(1 of 2);
  s[1]<< String[(a+b)*]("abba"); // Sends cons inl cons inr cons inr cons inl nil
  s[2]>> x; // Receives String[a*]("aa") = cons cons nil;
)

